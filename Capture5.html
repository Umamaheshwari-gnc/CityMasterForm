<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>City Master Form</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #74ebd5, #acb6e5);
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
    }
    form {
      max-width: 800px;
      margin: auto;
      background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
      padding: 30px;
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      position: relative;
      animation: fadeInForm 1s cubic-bezier(.68,-0.55,.27,1.55);
      border: 2px solid #74ebd5;
    }
    @keyframes fadeInForm {
      from { opacity: 0; transform: translateY(40px) scale(0.95);}
      to { opacity: 1; transform: translateY(0) scale(1);}
    }
    .form-label {
      color: #1976d2;
      font-weight: 500;
      transition: color 0.3s;
    }
    .form-control:focus, .form-select:focus {
      border-color: #1976d2;
      box-shadow: 0 0 0 0.2rem rgba(25, 118, 210, 0.15);
      transition: box-shadow 0.3s;
    }
    .btn-primary, .btn-outline-primary, .btn-info, .btn-warning, .btn-success, .btn-danger, .btn-secondary {
      background: linear-gradient(90deg, #1976d2 0%, #0d47a1 100%);
      color: white;
      border: none;
      transition: background 0.3s, transform 0.2s;
    }
    .btn-primary:hover, .btn-outline-primary:hover, .btn-info:hover, .btn-warning:hover, 
    .btn-success:hover, .btn-danger:hover, .btn-secondary:hover {
      background: linear-gradient(90deg, #0d47a1 0%, #1976d2 100%);
      color: white;
      transform: scale(1.05);
    }
    .btn-danger {
      background: linear-gradient(90deg, #d32f2f 0%, #b71c1c 100%);
    }
    .btn-danger:hover {
      background: linear-gradient(90deg, #b71c1c 0%, #d32f2f 100%);
    }
    .required-field::after {
      content: " *";
      color: red;
    }
    .input-error {
      border-color: #dc3545;
      box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
    }
    .modal-content {
      border-radius: 12px;
    }
    .modal-header {
      background: linear-gradient(to right, #1976d2, #0d47a1);
      color: white;
      border-radius: 12px 12px 0 0;
    }
    .popup-section {
      margin-top: 25px;
      padding-top: 15px;
      border-top: 1px solid #ccc;
    }
    #formMessage {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%);
      color: white;
      text-align: center;
      padding: 30px 50px;
      font-size: 22px;
      font-weight: bold;
      z-index: 1050;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.5s ease-in-out;
      min-width: 400px;
      max-width: 80%;
    }
    #formMessage.error {
      background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
    }
    #formMessage .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      background: transparent;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
    }
    
    /* Modal-specific message popups */
    .modal-message {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%);
      color: white;
      text-align: center;
      padding: 20px 30px;
      font-size: 18px;
      font-weight: bold;
      z-index: 1060;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.5s ease-in-out;
      width: 80%;
    }
    .modal-message.error {
      background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
    }
    .modal-message .close-btn {
      position: absolute;
      top: 5px;
      right: 10px;
      background: transparent;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -40%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    @media (max-width: 600px) {
      body {
        padding: 20px;
      }
      .modal-content {
        width: 90%;
        margin-top: 30%;
      }
      #formMessage {
        width: 90%;
        padding: 20px;
        font-size: 18px;
        min-width: unset;
      }
      .modal-message {
        width: 90%;
        padding: 15px;
        font-size: 16px;
      }
    }

    /* New styles for enhanced UI */
    .save-indicator {
      display: inline-block;
      margin-left: 10px;
      font-size: 14px;
      color: #28a745;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .save-indicator.show {
      opacity: 1;
    }
    .modal-footer .btn {
      min-width: 80px;
    }
    
    /* Consistent button styles */
    .modal-footer .btn-primary {
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>

<body>
<!-- Form Message Popup -->
<div id="formMessage">
  <button class="close-btn">&times;</button>
  <div id="messageContent"></div>
</div>

<form id="cityForm" class="container shadow-lg p-4 rounded-4 bg-gradient" style="background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%); border: 2px solid #74ebd5;">
  <h1 class="mb-3">City Master Form</h1>
  <h2 class="mb-4">City Details</h2>

  <div class="row g-3">
    <div class="col-12">
      <label for="city1" class="form-label required-field">City Name</label>
      <input type="text" id="city1" name="city1" required class="form-control form-control-lg border-primary shadow-sm">
    </div>

    <div class="col-md-6">
      <label for="country1" class="form-label required-field">Country</label>
      <select id="country1" name="country1" required class="form-select form-select-lg border-info shadow-sm">
        <option value="">--Select--</option>
        <option>India</option>
        <option>USA</option>
      </select>
    </div>

    <div class="col-md-6">
      <label for="state1" class="form-label required-field">State</label>
      <select id="state1" name="state1" required disabled class="form-select form-select-lg border-info shadow-sm">
        <option value="">--Select--</option>
      </select>
    </div>

    <div class="col-md-6">
      <label for="lan" class="form-label">Latitude</label>
      <input type="number" id="lan" name="lan" step="any" placeholder="e.g., 12.96" class="form-control form-control-lg border-success shadow-sm">
    </div>

    <div class="col-md-6">
      <label for="lon" class="form-label">Longitude</label>
      <input type="number" id="lon" name="lon" step="any" placeholder="e.g., 77.58" class="form-control form-control-lg border-success shadow-sm">
    </div>

    <div class="col-md-6">
      <label for="status" class="form-label required-field">Status</label>
      <select id="status" name="status" required class="form-select form-select-lg border-warning shadow-sm">
        <option value="Active" selected>Active</option>
        <option value="Inactive">Inactive</option>
      </select>
    </div>

    <div class="col-12 text-center">
      <button type="button" id="addAreaBtn" class="btn btn-primary btn-lg m-1 px-4 shadow">
        <i class="fas fa-plus-circle me-1"></i>Add Area
      </button>
      <button type="button" id="addStateBtn" class="btn btn-primary btn-lg m-1 px-4 shadow">
        <i class="fas fa-plus-circle me-1"></i>Add State
      </button>
      <button type="button" id="addCountryBtn" class="btn btn-primary btn-lg m-1 px-4 shadow">
        <i class="fas fa-plus-circle me-1"></i>Add Country
      </button>
    </div>
  </div>

  <div class="text-center mt-4">
    <button type="button" id="submitBtn" class="btn btn-primary btn-lg m-1 px-5 shadow">
      <i class="fas fa-paper-plane me-1"></i>Submit
    </button>
    <button type="button" id="clearBtn" class="btn btn-danger btn-lg m-1 px-5 shadow">
      <i class="fas fa-eraser me-1"></i>Clear
    </button>
  </div>
</form>

<!-- Area Modal -->
<div class="modal fade" id="areaModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-map-marker-alt me-2"></i>Add New Area</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Area Modal Message -->
        <div id="areaModalMessage" class="modal-message">
          <button class="close-btn">&times;</button>
          <div id="areaMessageContent"></div>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-12">
            <label for="newAreaInput" class="form-label required-field">Area Name</label>
            <input type="text" class="form-control" id="newAreaInput" placeholder="Enter area name">
            <div class="form-text">Only letters and spaces allowed</div>
          </div>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-6 mb-3 mb-md-0">
            <label for="areaModalCountry" class="form-label required-field">Country</label>
            <select class="form-select" id="areaModalCountry">
              <option value="">--Select Country--</option>
              <option>India</option>
              <option>USA</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="areaModalState" class="form-label required-field">State</label>
            <select class="form-select" id="areaModalState" disabled>
              <option value="">--Select State--</option>
            </select>
          </div>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-6 mb-3 mb-md-0">
            <label for="areaModalCity" class="form-label required-field">City</label>
            <select class="form-select" id="areaModalCity" disabled>
              <option value="">--Select City--</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="areaModalPin" class="form-label required-field">Pin Code</label>
            <input type="text" class="form-control" id="areaModalPin" placeholder="Enter 6-digit pin" maxlength="6">
            <div class="form-text">Must be exactly 6 digits</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="clearAreaBtn">Clear</button>
        <button type="button" class="btn btn-primary" id="saveAreaBtn">
          <i class="fas fa-save me-1"></i>Save
        </button>
      </div>
    </div>
  </div>
</div>

<!-- State Modal -->
<div class="modal fade" id="stateModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-map me-2"></i>Add New State</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- State Modal Message -->
        <div id="stateModalMessage" class="modal-message">
          <button class="close-btn">&times;</button>
          <div id="stateMessageContent"></div>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-12">
            <label for="newStateInput" class="form-label required-field">State Name</label>
            <input type="text" class="form-control" id="newStateInput" placeholder="Enter state name">
            <div class="form-text">Only letters and spaces allowed</div>
          </div>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-12">
            <label for="stateModalCountry" class="form-label required-field">Country</label>
            <select class="form-select" id="stateModalCountry">
              <option value="">--Select Country--</option>
              <option>India</option>
              <option>USA</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="clearStateBtn">Clear</button>
        <button type="button" class="btn btn-primary" id="saveStateBtn">
          <i class="fas fa-save me-1"></i>Save
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Country Modal -->
<div class="modal fade" id="countryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-globe me-2"></i>Add New Country</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Country Modal Message -->
        <div id="countryModalMessage" class="modal-message">
          <button class="close-btn">&times;</button>
          <div id="countryMessageContent"></div>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-12">
            <label for="newCountryInput" class="form-label required-field">Country Name</label>
            <input type="text" class="form-control" id="newCountryInput" placeholder="Enter country name">
            <div class="form-text">Only letters and spaces allowed</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="clearCountryBtn">Clear</button>
        <button type="button" class="btn btn-primary" id="saveCountryBtn">
          <i class="fas fa-save me-1"></i>Save
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-question-circle me-2"></i>Confirmation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p id="confirmationMessage">Are you sure you want to proceed?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="confirmYes">Yes</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap & jQuery -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
// Data for countries, states and cities
const locationData = {
  "India": {
    "Tamilnadu": ["Chennai", "Coimbatore", "Madurai"],
    "Kerala": ["Thiruvananthapuram", "Kochi", "Kozhikode"],
    "Karnataka": ["Bangalore", "Mysore", "Hubli"],
    "Andhra Pradesh": ["Hyderabad", "Vishakhapatnam", "Vijayawada"]
  },
  "USA": {
    "California": ["Los Angeles", "San Francisco", "San Diego"],
    "Texas": ["Houston", "Dallas", "Austin"],
    "New York": ["New York City", "Buffalo", "Rochester"],
    "Florida": ["Miami", "Orlando", "Tampa"]
  }
};

// Variables for message timeout
let messageTimeout;
let areaMessageTimeout;
let stateMessageTimeout;
let countryMessageTimeout;

// jQuery DOM Ready
$(function () {
  // Function to show form message for 3 seconds
  function showFormMessage(message, isError = false, duration = 3000) {
    // Clear any existing timeout
    clearTimeout(messageTimeout);
    
    // Set message content and styling
    $('#messageContent').text(message);
    $('#formMessage').toggleClass('error', isError);
    
    // Show the message
    $('#formMessage').fadeIn(300);
    
    // Set timeout to hide message after 3 seconds
    messageTimeout = setTimeout(function() {
      $('#formMessage').fadeOut(300);
    }, duration);
  }

  // Function to show area modal message for 3 seconds
  function showAreaModalMessage(message, isError = false, duration = 3000) {
    clearTimeout(areaMessageTimeout);
    
    $('#areaMessageContent').text(message);
    $('#areaModalMessage').toggleClass('error', isError);
    $('#areaModalMessage').fadeIn(300);
    
    areaMessageTimeout = setTimeout(function() {
      $('#areaModalMessage').fadeOut(300);
    }, duration);
  }

  // Function to show state modal message for 3 seconds
  function showStateModalMessage(message, isError = false, duration = 3000) {
    clearTimeout(stateMessageTimeout);
    
    $('#stateMessageContent').text(message);
    $('#stateModalMessage').toggleClass('error', isError);
    $('#stateModalMessage').fadeIn(300);
    
    stateMessageTimeout = setTimeout(function() {
      $('#stateModalMessage').fadeOut(300);
    }, duration);
  }

  // Function to show country modal message for 3 seconds
  function showCountryModalMessage(message, isError = false, duration = 3000) {
    clearTimeout(countryMessageTimeout);
    
    $('#countryMessageContent').text(message);
    $('#countryModalMessage').toggleClass('error', isError);
    $('#countryModalMessage').fadeIn(300);
    
    countryMessageTimeout = setTimeout(function() {
      $('#countryModalMessage').fadeOut(300);
    }, duration);
  }

  // Close message when close button is clicked
  $('.close-btn').on('click', function() {
    $(this).closest('.modal-message, #formMessage').fadeOut(300);
    clearTimeout(messageTimeout);
    clearTimeout(areaMessageTimeout);
    clearTimeout(stateMessageTimeout);
    clearTimeout(countryMessageTimeout);
  });

  // Populate state dropdown based on selected country
  $('#country1').on('change', function () {
    const country = $(this).val();
    const $state = $('#state1');
    $state.empty().append('<option value="">--Select--</option>').prop('disabled', !country);

    if (country && locationData[country]) {
      $.each(locationData[country], function (state) {
        $state.append(`<option value="${state}">${state}</option>`);
      });
      $state.prop('disabled', false);
    }
  });

  // Validate input fields - only allow letters and spaces
  function validateTextInput(input) {
    const originalValue = input.val();
    const filteredValue = originalValue.replace(/[^A-Za-z\s]/g, '');
    
    if (originalValue !== filteredValue) {
      input.addClass('input-error');
      setTimeout(() => input.removeClass('input-error'), 1000);
    }
    
    input.val(filteredValue);
    return /^[A-Za-z\s]+$/.test(filteredValue);
  }

  // Validate pin code - only allow numbers
  function validatePinInput(input) {
    const originalValue = input.val();
    const filteredValue = originalValue.replace(/\D/g, '');
    
    if (originalValue !== filteredValue) {
      input.addClass('input-error');
      setTimeout(() => input.removeClass('input-error'), 1000);
    }
    
    input.val(filteredValue);
    return /^\d{6}$/.test(filteredValue);
  }

  // Set up validation for all text inputs
  $('#city1, #newAreaInput, #newStateInput, #newCountryInput').on('input', function() {
    validateTextInput($(this));
  });

  // Set up validation for pin code
  $('#areaModalPin').on('input', function() {
    validatePinInput($(this));
  });

  $('#lan, #lon').on('input', function () {
    const id = $(this).attr('id');
    const val = parseFloat($(this).val());
    const isValid = id === 'lan' ? (val >= -90 && val <= 90) : (val >= -180 && val <= 180);
    if (!isValid) {
      $(this).addClass('input-error');
      setTimeout(() => $(this).removeClass('input-error'), 1000);
      $(this).val('');
    }
  });

  // Open modals
  $('#addAreaBtn').on('click', function () {
    $('#areaModal').modal('show');
    resetAreaModal();
  });

  $('#addStateBtn').on('click', function () {
    $('#stateModal').modal('show');
    resetStateModal();
  });

  $('#addCountryBtn').on('click', function () {
    $('#countryModal').modal('show');
    resetCountryModal();
  });

  // Modal dropdowns
  $('#areaModalCountry').on('change', function () {
    const country = $(this).val();
    const $state = $('#areaModalState');
    const $city = $('#areaModalCity');
    $state.empty().append('<option value="">--Select--</option>').prop('disabled', !country);
    $city.empty().append('<option value="">--Select--</option>').prop('disabled', true);
    $('#areaModalPin').val('');

    if (locationData[country]) {
      $.each(locationData[country], function (state) {
        $state.append(`<option value="${state}">${state}</option>`);
      });
      $state.prop('disabled', false);
    }
  });

  $('#areaModalState').on('change', function () {
    const country = $('#areaModalCountry').val();
    const state = $(this).val();
    const $city = $('#areaModalCity');
    $city.empty().append('<option value="">--Select--</option>').prop('disabled', !state);
    $('#areaModalPin').val('');

    if (locationData[country] && locationData[country][state]) {
      $.each(locationData[country][state], function (index, city) {
        $city.append(`<option value="${city}">${city}</option>`);
      });
      $city.prop('disabled', false);
    }
  });

  // Save Country
  $('#saveCountryBtn').on('click', function () {
    const country = $('#newCountryInput').val().trim();
    if (!validateTextInput($('#newCountryInput')) || !country) {
      showCountryModalMessage("Please enter a valid country name", true);
      return;
    }
    if (!locationData[country]) {
      locationData[country] = {};
      $('#country1').append(`<option value="${country}">${country}</option>`);
      $('#areaModalCountry').append(`<option value="${country}">${country}</option>`);
      $('#stateModalCountry').append(`<option value="${country}">${country}</option>`);
      
      // Show success message and reset form but don't close modal
      showCountryModalMessage("Country saved successfully!");
      setTimeout(function() {
        resetCountryModal();
      }, 3000);
    } else {
      showCountryModalMessage("Country already exists!", true);
    }
  });

  // Save State
  $('#saveStateBtn').on('click', function () {
    const state = $('#newStateInput').val().trim();
    const country = $('#stateModalCountry').val();

    if (!validateTextInput($('#newStateInput')) || !state || !country) {
      showStateModalMessage("Please fill all required fields correctly", true);
      return;
    }

    if (!locationData[country]) locationData[country] = {};
    if (!locationData[country][state]) {
      locationData[country][state] = [];
      if (country === $('#country1').val()) {
        $('#state1').append(`<option value="${state}">${state}</option>`);
      }
      
      // Show success message and reset form but don't close modal
      showStateModalMessage("State saved successfully!");
      
      // Show save indicator on the button
      $('#stateSaveIndicator').addClass('show');
      setTimeout(function() {
        $('#stateSaveIndicator').removeClass('show');
      }, 2000);
      
      // Reset the form after a brief delay
      setTimeout(function() {
        resetStateModal();
      }, 1000);
    } else {
      showStateModalMessage("State already exists!", true);
    }
  });

  // Save Area
  $('#saveAreaBtn').on('click', function () {
    const area = $('#newAreaInput').val().trim();
    const pin = $('#areaModalPin').val().trim();
    const country = $('#areaModalCountry').val();
    const state = $('#areaModalState').val();
    const city = $('#areaModalCity').val();

    if (!validateTextInput($('#newAreaInput')) || !area || 
        !validatePinInput($('#areaModalPin')) || !pin ||
        !country || !state || !city) {
      showAreaModalMessage("Please fill all required fields correctly", true);
      return;
    }

    // Show success message and reset form but don't close modal
    showAreaModalMessage("Area saved successfully!");
    setTimeout(function() {
      resetAreaModal();
    }, 3000);
  });

  // Clear buttons
  $('#clearAreaBtn').on('click', function() {
    resetAreaModal();
    showAreaModalMessage("Area form cleared!");
  });
  
  $('#clearStateBtn').on('click', function() {
    resetStateModal();
    showStateModalMessage("State form cleared!");
  });
  
  $('#clearCountryBtn').on('click', function() {
    resetCountryModal();
    showCountryModalMessage("Country form cleared!");
  });

  $('#clearBtn').on('click', function () {
    showConfirmation("Are you sure you want to clear all form data?", function() {
      $('#cityForm')[0].reset();
      $('#state1').prop('disabled', true);
      showFormMessage("Form cleared successfully!");
    });
  });

  $('#submitBtn').on('click', function () {
    const valid =
      validateTextInput($('#city1')) &&
      $('#city1').val().trim() &&
      $('#country1').val() &&
      $('#state1').val() &&
      validateCoordinate($('#lan').val(), -90, 90) &&
      validateCoordinate($('#lon').val(), -180, 180) &&
      $('#status').val();

    if (!valid) {
      showFormMessage("Please fill all the required fields correctly.", true);
      return;
    }

    showConfirmation("Are you sure you want to submit the form?", function() {
      showFormMessage("City details submitted successfully!");
      $('#cityForm')[0].reset();
      $('#state1').prop('disabled', true);
    });
  });

  // Utility functions
  function resetAreaModal() {
    $('#newAreaInput, #areaModalPin').val('');
    $('#areaModalCountry, #areaModalState, #areaModalCity').val('');
    $('#areaModalState, #areaModalCity').prop('disabled', true);
  }

  function resetStateModal() {
    $('#newStateInput, #stateModalCountry').val('');
  }

  function resetCountryModal() {
    $('#newCountryInput').val('');
  }

  function validateCoordinate(val, min, max) {
    if (!val) return true; // Empty is allowed
    const num = parseFloat(val);
    return !isNaN(num) && num >= min && num <= max;
  }

  function showConfirmation(message, yesCallback) {
    $('#confirmationMessage').text(message);
    $('#confirmationModal').modal('show');
    
    // Remove previous handlers
    $('#confirmYes').off('click');
    
    // Add new handler
    $('#confirmYes').on('click', function() {
      $('#confirmationModal').modal('hide');
      yesCallback();
    });
  }
});
</script>
</body>
</html>